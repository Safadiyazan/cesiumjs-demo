# LAATSim: The AAM Simulation Tool Shaping the Future of Urban Mobility

The landscape of urban transportation is on the verge of a revolution with the rise of Advanced Air Mobility (AAM) systems. These low-altitude passenger and delivery vehicles hold immense potential, but require sophisticated tools to propel research and development forward.

**Introducing LAATSim, the groundbreaking AAM simulation tool.** This innovative software meticulously replicates AAM systems in a digital environment, enabling users to model and analyze their behavior and performance with unparalleled accuracy.

**Empowering Stakeholders in the AAM Ecosystem.** LAATSim's modular framework empowers a diverse range of AAM stakeholders. Users can leverage a comprehensive toolkit and library to design and plan AAM operations, while developers have the freedom to contribute and build microservices through an open API gateway.

**More than a Tool, It's a Catalyst for Collaboration.** LAATSim sets the stage for groundbreaking research in the burgeoning field of AAM. We aim to inspire collaboration on a national and global scale, fostering a platform for innovation and advancement within the entire AAM ecosystem.

## Mission

The emergence of Advanced Air Mobility (AAM) holds immense potential to revolutionize urban transportation. However, integrating these low-altitude passenger and delivery vehicles into cityscapes requires navigating a complex landscape of challenges.

**At LAATSim, our mission is to empower stakeholders across the AAM ecosystem by providing a groundbreaking simulation tool that tackles these critical challenges head-on.**

**Understanding the Challenges**

* **Authentic Environment Creation:**  Accurately replicating real-world conditions is essential for reliable simulation and informed decision-making. LAATSim is meticulously designed to deliver an unparalleled level of authenticity, enabling users to analyze AAM behavior and performance with confidence.
* **Data-Driven Insights:**  Effective AAM development hinges on robust data analysis. LAATSim's comprehensive data visualization capabilities provide stakeholders with the insights they need to optimize operations and unlock new opportunities.
* **Scalability and Adaptability:**  AAM research requires flexibility. LAATSim's modular architecture allows users to customize simulations and integrate existing solutions, ensuring the tool scales effectively with evolving research needs.
* **Human Behavior Integration:**  Understanding human behavior within AAM systems is crucial. LAATSim facilitates the exploration of how individuals and communities interact with AAM vehicles, fostering the development of safe and user-centric solutions.

**LAATSim: A Catalyst for Collaboration**

By addressing these challenges, LAATSim empowers a diverse range of stakeholders, including:

* **Academia and Research Centers:**  LAATSim equips researchers to explore critical areas like human factors, modeling development, and overall AAM system design.
* **Regulators:** Our tool provides a platform to simulate complex airspace scenarios, informing the development of effective regulations for safe and efficient AAM integration.
* **Industry Players:** LAATSim equips AAM system and aircraft designers with a comprehensive platform to validate their designs within a realistic operational environment, accelerating the path to commercialization.

Through collaboration and a commitment to overcoming challenges, LAATSim fosters continuous progress towards a thriving AAM ecosystem that benefits all stakeholders.

## Software Design

LAATSim's core revolves around a modular framework designed to empower users with a customizable and extensible platform for simulating AAM operations. This section delves into the key components and functionalities that facilitate a comprehensive simulation environment.

**Modular Architecture for Flexibility**

LAATSim leverages a modular architecture, allowing users to tailor simulations to specific needs. This is achieved through:

* **Microservices:** The framework utilizes a collection of microservices, essentially independent software units, each encapsulating a specific functionality within the simulation. These microservices can be easily integrated or replaced, enabling customization and future expansion.
* **Open API Gateway:** Developers can contribute new functionalities by developing and integrating their own microservices through a secure API gateway. This fosters a collaborative environment and promotes continuous improvement of the framework.
* **Plugin Support:** The framework allows for the integration of plugins, further extending its capabilities. These plugins can address specific AAM-related needs, such as advanced visualization tools or specialized data analysis modules.

**Core System: The Orchestrator**

The core system acts as the central orchestrator, managing data flow and communication within the framework. Here's a breakdown of its key responsibilities:

* **Microservice and Database Management:** The core system manages the interaction between user requests, microservices, and the databases. It retrieves relevant microservices and data based on the user's simulation requirements.
* **Model Classification:** Microservices and databases are categorized into three main groups: Modeling (libraries for simulation components), Ruling (standardized models aligned with regulations), and Scenarios (user input and existing data defining the simulation environment).
* **API Gateway Communication:** The core system interacts with the user interface through an API gateway, facilitating data exchange and delivering simulation results.

**User Interface: Tailored Insights**

The user interface (UI) serves as the primary interaction point for users. It provides a web-based platform for:

* **Customizable Views:** The UI can be customized based on the user's sector (industry, academia, regulation, operations). This ensures that relevant insights and data visualizations are presented effectively.
* **Data Export:** Users can export simulation outputs, including data and reports, for further analysis and documentation.

**Microservices: Building Blocks of Simulation**

Microservices are the building blocks for simulating AAM operations. Each microservice represents a set of libraries and applications encompassing specific models and algorithms. These can include:

* **Human Behavior Modeling:** Models that simulate how humans interact with the AAM system, including pilots, air traffic controllers, and passengers.
* **Aircraft Dynamics Modeling:** Models that capture the flight characteristics and performance of AAM vehicles.
* **Airspace Management Modeling:** Models that simulate airspace utilization, traffic flow, and potential conflicts.
* **Subsystems Modeling:** Models that represent specific subsystems within the AAM system, such as propulsion systems or communication networks.

**Database Management: Storage and Security**

The framework utilizes a robust database system to store various data elements crucial for simulations:

* **Settings and Parameters:** Databases store various aircraft, airspace, traffic, and simulation settings used for analysis. User inputs are also stored in designated databases with appropriate security measures.
* **Real-Time Data Integration:** In real-time operation scenarios, encrypted measurement data can be stored in a dedicated database. This data can be anonymized and used for future research and development efforts.
* **Compliance with Regulations:** Data encryption adheres to local regulations, ensuring data privacy and security.

**Cloud-Based Infrastructure: Scalability and Performance**

LAATSim leverages a cloud-based server infrastructure to provide:

* **Virtual Private Cloud (VPC):**  The VPC allocates dedicated resources for each user's simulation, enabling high-performance computing for complex scenarios and real-time operations.
* **Seamless User Experience:** The user interface functions as a server-side web application, eliminating the need for users to install specific software. Additionally, the VPC grants users access to relevant data based on their permissions. 

**Openness for Collaboration and Innovation**

LAATSim fosters collaboration and innovation through the following features:

* **Developer Access:** External developers can leverage the API gateway to build and contribute new microservices, enriching the framework's functionalities.
* **Plugin Integration:** Licensed plugins can be integrated to address specific user needs, further enhancing the simulation capabilities.

**Conclusion**

LAATSim's software design prioritizes modularity, flexibility, and user experience. By leveraging microservices, open APIs, and a cloud-based infrastructure, the framework empowers users to conduct comprehensive AAM simulations, fostering informed decision-making and accelerating the development of this promising transportation technology. The proposed software design is shown in Figure 1.

![LAATSim simulation software design](./figures/Framework.png)
**Figure 1. LAATSim Simulation Software Design**


## Application

### Building the LAATSim with CesiumJS

The LAATSim is a powerful web-based application designed to streamline and enhance air mobility scenario modeling, analysis, and optimization. This modular tool leverages the strengths of various technologies to deliver a user-friendly and visually immersive experience. Let's delve into how CesiumJS plays a crucial role in this application:

**Realistic Airspace Environment:**

CesiumJS, a powerful geospatial visualization library, provides the foundation for rendering a realistic 3D representation of the airspace. This allows users to visualize simulated scenarios within a familiar and geographically accurate context. Imagine seeing low-altitude aircraft trajectories overlaid on a digital map with detailed terrain, buildings, and other relevant environmental features. CesiumJS empowers users to intuitively grasp the spatial relationships and potential interactions within the airspace.

**Interactive Visualization:**

CesiumJS offers extensive capabilities for interactive visualization. Users can zoom, pan, and rotate the 3D airspace environment, gaining a comprehensive understanding of the simulated scenarios from various perspectives. This interactivity facilitates in-depth analysis and exploration of air traffic patterns, potential conflicts, and overall airspace utilization.

**Data Integration:**

CesiumJS seamlessly integrates with other technologies used in the LAATSim. For instance, flight path data generated by the simulation engine can be seamlessly visualized within the CesiumJS-powered 3D environment. This allows users to directly observe the simulated behavior of low-altitude aircraft within the context of the realistic airspace.

**Enhanced User Experience:**

The integration of CesiumJS significantly elevates the user experience of the LAATSim. By replacing traditional 2D visualizations with a dynamic 3D environment, CesiumJS fosters a more intuitive and engaging experience for users. This visual representation aids in comprehending complex air traffic scenarios and facilitates informed decision-making.

CesiumJS plays a vital role in the LAATSim by providing a realistic, interactive, and user-friendly platform for visualizing and analyzing air mobility scenarios. It empowers users with a powerful tool to explore, optimize, and ultimately pave the way for the future of efficient and safe air traffic management.

![Screenshot of LAATSim](./figures/LAATSimUI.png)
**Figure 2. LAATSim intergration with CesiumJS - User interface**

Learn more about CesiumJS: https://cesium.com/platform/cesium-ion/.

### Main Features

#### (i) Data Synchronization from MATLAB to CesiumJS

The LAATSim tool encapsulates several critical parameters exported from the MATLAB simulation, serving as the foundation for visualizing the scenario in CesiumJS. Let's delve into the key data structures:

- **`SimInfo`:** This object stores vital simulation time information, including:
  - `tf`: The final simulation time (in seconds).
  - `dtS`: The simulation time step (in seconds).
  - `x`, `y`, `z`: Arrays containing the aircraft's position coordinates throughout the simulation (in meters). These arrays correspond to the time steps `dtS` defined in `tf`, and are stored in the array `pdt`.
  - `stat`: An integer representing the aircraft's flight status (0: inactive, 1: active, 2: arrived). These arrays correspond to the time steps `dtS` defined in `tf`, and are stored in the array `statusdt`.

- **`Settings`:** This object houses configuration details for the simulated airspace, comprising:
  - `dx`: The size of the airspace along the x-axis (in meters).
  - `dy`: The size of the airspace along the y-axis (in meters).
  - `dz`: The size of the airspace along the z-axis (in meters).
  - `as`: Additional airspace configuration settings (specific details might vary based on your simulation).

- **`ObjAircraft`:** This crucial element is an array of objects, each representing an aircraft within the simulation. Each object encompasses the following properties:
  - `tda`: The departure time of the aircraft (in seconds).
  - `taa`: The arrival time of the aircraft (in seconds).
  - `rs`: The safety radius of the aircraft (in meters).
  - `rd`: The detection radius of the aircraft (in meters).


To seamlessly visualize simulation results in CesiumJS, a robust mechanism synchronizes data between MATLAB and the web-based frontend. Here's a detailed walkthrough of the process:
   - The core simulation runs in MATLAB, generating critical airspace data.
   - The `ExportJSON` function (code snippet below) compiles essential parameters into a structured JSON file.

```matlab
function [scenarioName] = ExportJSON(SceStr,SimInfo,ObjAircraft,TFC,EC,Settings)
M = SimInfo.M(end); % number of aircraft
full_pdt = full(SimInfo.pdt)'; % tranform position matrix
full_stat = full(SimInfo.statusdt)'; % transform status matrix
ObjAircraftData = cell(1, M);
for i = 1:M
    x = double(full_pdt(3*i-2, :)); % x position [m]
    y = double(full_pdt(3*i-1, :)); % y position [m]
    z = double(full_pdt(3*i, :)); % z position [m]
    stat = double(full_stat(i, :));  % aircraft flight staus {0-inactive, 1-active, 2-arrived}
    ObjAircraftData{i} = struct(...
    'stat', stat,...
    'tda',max(ObjAircraft(i).tdp,0),... % aircraft departure time [s]
    'taa',min(ObjAircraft(i).taa,SimInfo.tf),... % aircraft arrival time [s]
    'rs',ObjAircraft(i).rs,... % aircraft safety radius [m]
    'rd',ObjAircraft(i).rd,... % aircraft detection radius [m]
    'x', x,...
    'y', y,...
    'z', z...
    );
end
Data.SimInfo.tf = SimInfo.tf; % simulation final time [s]
Data.SimInfo.dtS = SimInfo.dtS; % simulation time step [s]
Data.Settings.dx = Settings.Airspace.dx; % Airspace x-axis size [m]
Data.Settings.dy = Settings.Airspace.dy; % Airspace y-axis size [m]
Data.Settings.dz = Settings.Airspace.dz; % Airspace z-axis size [m]
% Export Object to JSON file
Data.ObjAircraft = ObjAircraftData;
json_str = jsonencode(Data);
TimestampNow = now;
scenarioName = [SceStr ' '  datestr(TimestampNow,'yyyy-mm-dd HH:MM')];
file_name = ['./public/Outputs/' 'SimOutput_' SceStr '_'  datestr(TimestampNow,'yyyymmdd_hhMM') '.json'];
fid = fopen(file_name, 'w');
if fid > 0
    fwrite(fid, json_str, 'char');
    fclose(fid);
    disp(['Data saved to ' file_name]);
else
    disp('Error opening the file for writing.');
end
end
```

**Benefits of this Approach:**

- **Streamlined Data Transfer:** JSON, a lightweight and cross-platform format, facilitates efficient transfer between MATLAB and the web environment.

- **Structured Data Representation:** JSON's hierarchical structure enables comprehensive and organized storage of simulation parameters.

- **Seamless Integration with CesiumJS:** CesiumJS directly accepts parsed JSON data, enabling the creation of rich and interactive visualizations.

**To conclude,** this robust synchronization process bridges the gap between MATLAB's simulation capabilities and CesiumJS's visualization prowess. It guarantees a seamless flow of data, empowering users to explore and analyze air mobility scenarios within a dynamic and informative 3D environment.

#### (ii) Converting XYZ Positions to Geospatial Coordinates (Longitude, Latitude, Height)

A crucial feature within the application involves transforming XYZ positions obtained from the simulation into meaningful geospatial coordinates (longitude, latitude, and height). This conversion process enables the visualization of aircraft trajectories within a real-world context on the CesiumJS map.

The Conversion Workflow:

1. **Iterating Through Aircraft Data:** The code snippet below iterates through the `ObjAircraft` array in the JSON data using `forEach`. This loop processes each aircraft object and its associated XYZ position data. However, the provided code limits the processing to a specific range (index 0 to 299) for demonstration purposes and runtime performance. You might want to adjust this based on your actual data structure.
``` javascript
data.ObjAircraft.forEach((ObjAircraft, index) => {
  if ((index > 0) & (index < 300)) { // Adjust the index range as needed
    // ... conversion logic here
  }
});
```

2. **Trajectory Point Generation:** Inside the loop, a new array named `trajectoryPositions` is created to store the converted geospatial coordinates for each aircraft. The code iterates through the aircraft's XYZ position arrays (`ObjAircraft.x`, `ObjAircraft.y`, `ObjAircraft.z`) with a defined step size (`dt`). For each iteration:

    - The `computeNewPoint` function is called, taking the center point (`center`) and the current XYZ offsets (`dx`, `dy`, `dz`) as arguments.

    - The resulting converted point (`currentPosition`) is then pushed into the `trajectoryPositions` array.

``` javascript
const trajectoryPositions = [];
for (let i = 0; i < ObjAircraft.x.length; i += dt) {
  const currentPosition = computeNewPoint(center, ObjAircraft.x[i], ObjAircraft.y[i], ObjAircraft.z[i]);
  trajectoryPositions.push({
    longitude: CesiumMath.toDegrees(Cartographic.fromCartesian(currentPosition).longitude),
    latitude: CesiumMath.toDegrees(Cartographic.fromCartesian(currentPosition).latitude),
    height: Cartographic.fromCartesian(currentPosition).height
  });
}
```

3. **`computeNewPoint` Function:** This function takes the center point of the simulated airspace (`center`) and the XYZ offsets (`dx`, `dy`, `dz`) as input. Here's a breakdown of its functionality:

    - Offset Matrix Creation: The function utilizes `Transforms.eastNorthUpToFixedFrame` from the Cesium library. This method generates a transformation matrix that considers the Earth's curvature (using the WGS84 ellipsoid) to convert offsets relative to East, North, and Up (AGL) into a fixed-frame coordinate system.

    - Offset Point Calculation: The provided offsets (`dx`, `dy`, `dz`) are multiplied by the created transformation matrix (`offsetMatrix`) using `Matrix4.multiplyByPoint`. This operation effectively applies the East, North, Up offsets to the center point, resulting in the new converted point (`offsetPoint`) in the fixed-frame coordinate system.

``` javascript
function computeNewPoint(center, dx, dy, dz) {
  var offsetMatrix = Transforms.eastNorthUpToFixedFrame(center, Ellipsoid.WGS84, new Matrix4());
  var offsetPoint = Matrix4.multiplyByPoint(offsetMatrix, new Cartesian3(dx, dy, dz), new Cartesian3());
  return offsetPoint;
}
```
**Benefits of this Approach:**

- **Real-World Context:** By transforming simulated XYZ data into longitude, latitude, and height, the application enables visualization of aircraft trajectories within a familiar geographic context. This enhances user comprehension and facilitates the analysis of air traffic patterns within the simulated airspace.

- **Accuracy:** The integration of Cesium's geospatial transformation functions ensures accurate conversion, considering the Earth's curvature. This guarantees that the displayed aircraft positions correspond to their actual locations within the real world.

- **Flexibility:** This approach is adaptable to various simulation scenarios. The `computeNewPoint` function can be tailored to handle different coordinate system origins or offset calculation methods based on your specific simulation setup.

- **Seamless Integration with CesiumJS:** The converted geospatial coordinates (longitude, latitude, height) directly align with the data format expected by CesiumJS. This streamlined integration facilitates the creation of visually compelling and informative 3D visualizations of the simulated air traffic.

**To conclude,** this conversion approach empowers you to bridge the gap between the simulated world and the real world, fostering a more intuitive and informative user experience for analyzing and understanding air mobility scenarios. A critical element in this method is the `computeNewPoint` function. It leverages Cesium's geospatial transformation capabilities to account for the Earth's curvature and convert the simulated XYZ positions, which are relative to a potentially arbitrary origin, into meaningful longitude, latitude, and height values that can be accurately visualized on the CesiumJS model.

#### Keyboard

#### User Inputs and React 

#### UI

### Future Directions














